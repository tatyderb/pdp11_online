# Реализация функций при `word mem[ ]`

lesson = 312215
lang = c

## SKIP VIDEO

https://youtu.be/0R70V9aeszs

## Запись и чтение слова

**Внимание! Реализуем или вариант `byte mem[MEMSIZE]` или вариант `word mem[MEMSIZE]`. Посылаем свой код в проверяющую систему [здесь](https://stepik.org/lesson/870973)**

Разберем реализацию функций, когда массив определен как 

```cpp
word mem[MEMSIZE];
```
![mem_word.png](https://stepik.org/media/attachments/lesson/312212/mem_word.png)

Запись и чтение в слово с адресом `a` - это запись и чтение значения из `mem[a]`. Стоит сразу проверять, что адрес четный. При нечетном адресе будем останавливать программу. Обратите внимание на скобки, приоритет сравнения `==` выше, чем у побитового `&`.

```cpp
// Запись слова val по адресу adr
void w_write (adress adr, word val)
{
    // проверка, что адрес слова четный
    assert((mem & 1) == 0);
    mem[adr] = val;
}
    
// Возвращает слово по адресу adr
word w_read (adress adr)
{
    return mem[adr];
}
```

Задание: закомментируйте все тесты, кроме чтения и записи слова, напишите и отладьте функцию работы с словами.

## `b_read`

Разберемся с функцией чтения байта.

![1w2b.png](https://stepik.org/media/attachments/lesson/312215/1w2b.png)

Пусть в `mem[a]` лежит слово `0x0b0a` и это слово лежит по адресу `a = 4`. Тогда по адресу 4 лежит число `0x0b`, по адресу 5 лежит число `0x0a`. Разобьем слово `w` на младший и старший байты так:

* младший байт (по четному адресу):
    * запишем в `b` младший байт из `mem[a]`, который легко получить простым преобразованием типа к `byte`.
* старший байт (по нечетному адресу):
    * сдвинем в `w` данные вправо на 8 бит, чтобы 0x0b оказалось в младшем байте и преобразуем тип к (byte).
    
Заметим, что если я хочу прочитать байт `0x0a` по адресу 5, мне нужно прочитать слово по адресу 4, так как слова хранятся только по четным адресам. По нечетным адресам место не используется.

```cpp
// Возвращает байт по адресу adr
word b_read (adress adr)
{
    word w;
    byte bres;
    // реализуем little-endian
    // четный байт - меньший адрес - в младший байт
    if (adr % 2 == 0) {
        w = mem[adr];
        bres = (byte)w;
    }
    else {
        w = mem[adr - 1];
        bres = (byte)(w >> 8);
    }
    return bres;
}
```
Задание: раскомментируйте тест с записью слова и чтением 2 байт и отладьте код.

## b_write

* Напишите самостоятельно функцию `b_write`. 
* Раскомментируйте все тесты и отладьте код.
* Допишите еще тесты в свой код, если ваши тесты не поймали все ошибки.